<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8" />
<title>Log client</title>
<style>
#output, #command {
	margin: 1em;
}

#output {
	font-size: 0.8em;
}

#commands {
	background-color: #eee;
	padding: 1em
}

p {
	margin: 0em;
}

.printLog {
	color: blue;
}

.printCommand {
	color: green;
}

.printStatus {
	font-style: italic;
	color: gray;
}
</style>
</head>
<body>


	<div id="commands"></div>

	<!--<input onkeypress="return keyPress(event, this);"/>-->
	<div id="output"></div>
</body>
<script>
	var address = "ws://127.0.0.1:8889";

	var logSocket = new WebSocket(address + "/log");
	var commandSocket = new WebSocket(address + "/command");

	function sendCommand(command) {

		print("cmd " + command, "printCommand");
		commandSocket.send(command);
	}

	function displayCommandButton(elem, command) {
		var button = document.createElement("button");
		elem.appendChild(button);

		var text = document.createTextNode(command);
		button.appendChild(text);

		button.onclick = function() {
			sendCommand(command);
		};
	}

	function displayCommandButtons(commandList) {
		var elem = document.getElementById('commands');

		// clear
		while (elem.firstChild) {
			elem.removeChild(elem.firstChild);
		}

		// add
		for (var i = 0; i < commandList.length; i++) {
			displayCommandButton(elem, commandList[i]);
		}
	}

	function print(text, cssClass) {
		cssClass = cssClass || '';

		var output = document.getElementById("output");
		var p = document.createElement("p");
		p.appendChild(document.createTextNode(text))
		p.className = cssClass;

		output.insertBefore(p, output.firstChild);
	}

	logSocket.onopen = function() {
		print("connected to " + logSocket.url, "printStatus");
	};

	logSocket.onmessage = function(evt) {
		print("log " + evt.data, "printLog");
	};

	logSocket.onclose = function(event) {
		print("disconnected from " + logSocket.url + ": " + event.reason,
				"printStatus");
	};

	commandSocket.onmessage = function(evt) {
		print("commands: " + evt.data, "printCommand");
		displayCommandButtons(JSON.parse(evt.data));
	};
</script>
</html>
